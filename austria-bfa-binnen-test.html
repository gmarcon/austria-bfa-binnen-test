<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BFA-Binnen Theorie Test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="data/questions.js"></script>
    <script type="text/javascript">

        //
        function shuffle(array) {
            var m = array.length, t, i;
            // While there remain elements to shuffle…
            while (m) {

                // Pick a remaining element…
                i = Math.floor(Math.random() * m--);

                // And swap it with the current element.
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }

        // When loading, generate the questionnaire:
        $(document).ready(function() { 
            shuffle(questions);
            forty_questions = questions.slice(0,40);
            createForm();
        });

        function createForm() {
            $.each(forty_questions, function(question_idx, o){
                questionHtml = ''
                questionHtml += '<h2>' + o.question + '</h2>';
                $.each(o.answers, function(answer_idx, o) {
                    questionHtml += `<div><input type="checkbox" name="${question_idx}-${answer_idx}" value="${o.correct}"><label for="${question_idx}-${answer_idx}">${o.answer}</label></div>`;
                })
                if(o.image)
                    questionHtml += `<img src="${o.image}" style="max-width: 400px; max-height: 200px;">`
                $('div[name="questions"]').append(questionHtml);
            })
        }

        // Check answers:
        function checkAnswers() {
            correct_answers = 0;
            $.each(forty_questions, function(question_idx, o){
                correct = true;
                $.each(o.answers, function(answer_idx, o) {
                    checkbox = $(`input[name=${question_idx}-${answer_idx}]`);
                    label = $(`label[for=${question_idx}-${answer_idx}]`);
                    if(checkbox[0].checked.toString() == checkbox[0].value) {
                        label.css('background-color', '');
                    } else {
                        correct = false;
                        label.css('background-color', 'red');
                    }
                })
                if(correct)
                    correct_answers++;
            })
            $('div[name="results"]').html(`${correct_answers}/${forty_questions.length} correct answers!`);
        }

        // Clean check:
        function cleanCheckAnswers() {
            $.each(forty_questions, function(question_idx, o){
                $.each(o.answers, function(answer_idx, o) {
                    label = $(`label[for=${question_idx}-${answer_idx}]`);
                    label.css('background-color', '');
                })
            })
            $('div[name="results"]').html("Results will appear here!");
        }

</script>
</head>
<body>
    <div style="position: -webkit-sticky; position: sticky; top: 0; background-color: #ffffff;">
        <h1>BFA Binnen-Theorie</h1>
        <button type="button" onclick="checkAnswers()">Check</button>
        <button type="button" onclick="cleanCheckAnswers()">Clean</button>
        <div name="results">Results will appear here!</div>
    </div>
    <form>
        <div name="questions"></div>
    </form>
</body>